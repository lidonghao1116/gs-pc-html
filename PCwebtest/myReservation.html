<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/head-foot.css" rel="stylesheet" type="text/css" />
<link href="css/myReservation.css" rel="stylesheet" type="text/css" />
<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/top.js"></script>
<script type="text/javascript" src="js/jquery.pagination.js"></script>
<title>家策好服务-我的预约</title>
</head>
<body>
	<!--头部-->
	<div class="head_box">
		<div class="head">
			<div class="left logo">
				<a  target="_self">
					<img src="img/logo0.png"/>
				</a>
			</div>
			<div class="left more_s">
				<select>
					<option>更多导航</option>
					<option>更多导航0</option>
					<option>更多导航1哈</option>
				</select>
			</div>
			<div class="right head_r">
				<ul>
					<li><a >登录</a></li>
					<li><a >退出</a></li>
					<li><a >我的预约</a></li>
					<li><a >我的账户</a></li>
					<li class="wechat"><a>官网微信</a>
						<div class="wechat_b">
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!--主要内容-->
	<div class="content_b">
		<div class="content_nav clearfix">
			<p>个人中心</p>
			<ul>
				<li>
					<a class="active" href="myReservation.html" target="_self">我的预约</a>
				</li>
				<li><a href="myOrder.html" target="_self">我的订单</a></li>
				<li><a href="myProfile.html" target="_self">我的账户</a></li>
			</ul>
			<a class="back_in" href="index.html">返回家政公司</a>
		</div>
	</div>
	<div class="main_content mine_content yuyue">
		<!-- <ul class="content_tab">
			<li  data-stuCode="">全部预约</li>
			<li class="active" data-stuCode="01">待处理</li>
			<li data-stuCode="02">已处理</li>
			<li data-stuCode="03">已取消</li>
		</ul> -->
		<!-- <div class="line"></div> -->
		<ul class="info_title no_p">
			<li class="first">订单详情</li>
			<li>服务对象</li>
			 <li class="tt_width">价格预算</li> 
			<li class="mini">订单状态</li>
			<!-- <li class="tt_width">交易流程</li> -->
			<li>操作</li>
		</ul>
		<div class="resList">
			<!-- <table class='orderlist'>
				<tr>
					<th colspan='7'>
						<p class='left'><a class='link_index'>天天家政（徐汇店）</a><span>2017-12-10 10:01:00</span></p>
						<p class='right'>订单编号：022017120500001</p>
					</th>
				</tr>
				<tr>
					<td class='first'>
						<div class='staff_info'>
							 <img src='img/dzstaff.png'/>
							<div class='r_staff_info'>
								<h3>月嫂</h3>
								<h4>张阿姨</h4>
								<p>40岁|属羊|上海人|处女座|高中</p>
							</div> 
						</div>
					</td>
					<td>
						<p class='p_top'><span class='memeber'>张三</span></p>
						<p>589878</p>
					</td>
					<td class='tt_width'>
						<p class='p_top'>￥6,000.00</p>
						<p>（阿姨工资+服务费）</p>
					</td>
					<td>
						<p>待面试</p>
						<p><a class="details" data-url="ttjz" data-orderno="022017122000009" target="_blank">预约详情</a></p>
					</td>
					<td class='tt_width'>
						<p>定金 > 面试 > 尾款</p>
						<p class='p_status'>待面试</p>
					</td>
					<td>
						<p><a class='cancel_bt' data-stucode='01' data-orderno='022017121400001'>取消预约</a></p>
					</td>
				</tr>
			</table>
			<table class='orderlist'>
				<tr>
					<th colspan='7'>
						<p class='left'><a class='link_index'>天天家政（徐汇店）</a><span>2017-12-10 10:01:00</span></p>
						<p class='right'>订单编号：022017120500001</p>
					</th>
				</tr>
				<tr>
					<td class='first'>
						<div class='staff_info'>
							 <img src='img/dzstaff.png'/>
							<div class='r_staff_info'>
								<h4 class=''>月嫂</h3>
								<h4>服务定制</h4>
							</div> 
						</div>
					</td>
					<td>
						<p class='p_top'><span class='memeber'></span></p>
						<p class='p_grey'></p>
					</td>
					<td class='tt_width'>
						<p class='p_top'></p>
						<p class='p_grey'></p>
					</td>
					<td>
						<p class='p_grey'>待面试</p>
						<p><a class="details" data-url="ttjz" data-orderno="022017122000009" target="_blank">预约详情</a></p>
					</td>
					<td class='tt_width'>
						<p class='p_grey'>定金 > 面试 > 尾款</p>
						<p class='p_status'>待面试</p>
					</td>
					<td>
						<p><a class='cancel_bt p_grey' data-stucode='01' data-orderno='022017121400001'>取消预约</a></p>
					</td>
				</tr>
			</table> -->
		</div>

		<div id="pagination">

		</div>
	</div>
	<!--取消预约弹窗-->
	<div class="mask">
		<div class="alert">
			<a class="close"></a>
			<h1>选择取消原因</h1>
			<h2>确定要取消预约吗？取消预约后，不能恢复。</h2>
			<ul class="cancel_r clearfix">
				<li class="">不想要了</li>
				<li>家政公司不能满足需求</li>
				<li>已经找到阿姨</li>
				<li>没有合适的阿姨</li>
				<li>需求填错，重新下单</li>
				<li class="other">其他原因</li>
			</ul>
			<textarea name="reason" placeholder="请输入取消原因"></textarea>
			<div class="alert_bt">
				<button class="cancel">再想想</button>
				<button class="ok">确定</button>
			</div>
		</div>
	</div>
	<!--底部-->
	<!-- <div class="foot_box">
		<div class="foot">Copyright@2016上海家策教育科技有限公司<a href="http://www.miitbeian.gov.cn" target="_blank">沪ICP备16022947号-1</a></div>
	</div> -->
	<iframe scrolling="no" src="footer.html" width="100%" frameborder="0" height="270px"></iframe>
	<div class="bottom_fixed">
		<div class="bottom_fixed_link">
			<img class="top_img" src="img/qqren.png"/>
			<div class="link_phone">
				<p>服务热线</p>
				<p></p>
			</div>
			<div class="qq_link">
				<p>QQ交谈</p>
				<p>QQ交谈</p>
				<p>QQ交谈</p>
			</div>
			<div class="lin_wechat">
			</div>
		</div>
		<div id="goTopBtn" class="back_top">返回顶部</div>
	</div>
</body>
<script type="text/javascript">
	        var pageNumber = 1;
			var pageSize = 5;
			function pagination(records){
				$("#pagination").pagination(records, {
				    num_edge_entries: 1,
				    num_display_entries: 4,
				    current_page:pageNumber-1,
				    items_per_page:pageSize,
				    prev_text:"上一页",
				    next_text:"下一页",
				    callback: page_index
				});
			};

			function page_index(page_index){
				var pageNumber = page_index+1;
				var orderstatus="";
				$(".content_tab li").each(function(){
					if($(this).hasClass("active")){
						orderstatus=$(this).attr("data-stuCode");
					}
				})
				reserveorders(pageNumber,pageSize);
			};
			function reserveorders(pageNumber,pageSize){
				$.ajax({
			        url:publicPath+"/api/reserveorders/reserve/list",
			        type: "get",
			        data: {pageNumber:pageNumber,pageSize:pageSize,orderstatus:"01"},
			        dataType: "json",
			        async:false,
			        success: function success(data) {
			            if(data.success){
			                if(data.code == 0){
								var dataJD = data.jsonData.rows;
								if(dataJD.length > 0){
									var html = "";
									$.each(dataJD, function(i,item){
										var headImage = "";
										var staffName = "";
										var basicinfo = "";
										if(item.staffId!=""&&item.staffId!=null){
											headImage = item.staffInfo.headImage;
											if (item.staffInfo.sex == "01") {
											staffName = item.staffInfo.staffName.split("")[0] + "师傅";
											} else if (item.staffInfo.sex == "02") {
											staffName = item.staffInfo.staffName.split("")[0] + "阿姨";
											}
											basicinfo = "<p>"+item.staffInfo.age+"岁 | 属"+item.staffInfo.zodiacValue+" | "+item.staffInfo.nativePlaceValue+"人 | "+item.staffInfo.constellationValue+" | "+item.staffInfo.educationValue+"</p>";
										}else{
											headImage = "img/dzstaff.png";
											staffName = "服务定制";
											basicinfo = "";
										}
										
										var salary = "";
										if(item.orderCustomer.salary!=null && item.orderCustomer.salary!=undefined){
										salary = RetainedDecimalPlaces(item.orderCustomer.salary);
										}
										var phone0 = item.memberMobile.substr(0,3);
										var phone1 = item.memberMobile.substr(7,11);
										html+="<table class='orderlist'>"+
												"<tr>"+
													"<th colspan='7'>"+
														"<p class='left'><a class='link_index' href='http://"+window.location.host+"/"+item.tenantInfo.domain+"/index.html"+"'>"+item.tenantInfo.websiteName+"</a><span>"+item.orderTime+"</span></p>"+
														"<p class='right'>订单编号："+item.orderNo+"</p>"+
													"</th>"+
												"</tr>"+
												"<tr>"+
													"<td class='first'>"+
														"<div class='staff_info'>"+
															"<img src='"+ headImage +"'/>"+
															"<div class='r_staff_info'>"+
																"<h3>"+item.serviceItemCodeValue+"</h3>"+
																"<h4>"+staffName+"</h4>"+
																basicinfo+
															"</div>"+ 
														"</div>"+
													"</td>"+
													"<td>"+
														"<p class='p_top'><span class='memeber'>"+item.memberName+"</span></p>"+
														"<p>"+phone0+" **** "+phone1+"</p>"+
													"</td>"+
													"<td class='tt_width'>"+
														"<p class='p_top'>￥"+salary+item.orderCustomer.salaryTypeValue+"</p>"+
														"<p class=''>（价格预算）</p>"+
													"</td>"+
													"<td class='mini'>"+
														"<p>待处理</p>"+
														"<p><a class='details' data-domain='"+item.tenantInfo.domain+"' data-orderno='"+item.orderNo+"' target='_blank'>预约详情</a></p>"+
													"</td>"+
													"<td>"+
														"<p><a class='cancel_bt' data-orderno='"+item.orderNo+"'>取消预约</a></p>"+
													"</td>"+
												"</tr>"+
											"</table>";
									});
									$(".resList").html(html);
									$("#pagination").show();
								}else{
									$(".resList").html("<div class='no_found'><p>暂无内容，去看看其他的吧~</p></div>");
									$("#pagination").hide();
								}
			                	console.log(data.msg);
			                }else{
			                    console.log(data.msg);
			                }
			            }else{
			                console.log(data.msg);
			            }
			        }
			    });

			};
	$(function(){
		//加载数据
		$(function() {
			//总数查询
			$.ajax({
				url: publicPath+"/api/reserveorders/reserve/list",
				type: "get",
				data: {orderstatus:"01"},
				dataType: "json",
				async:false,
				success: function success(data) {
					if(data.success) {
						if(data.code == 0) {
							var dataJD = data.jsonData;
							pagination(dataJD.records);
							console.log(data.msg);
						} else {
							console.log(data.msg);
						}
					}
				}
			});

		})
	
		$(".resList").on("click",".orderlist .details",function(){
			var orderNo=$(this).attr("data-orderNo");
			var domain=$(this).attr("data-domain");
			location.href="http://"+window.location.host+"/"+domain+"/reservationDetail.html?orderNo="+orderNo;
		})
		//预约订单取消
		$(".resList").on("click",".orderlist .cancel_bt",function(){
			var orderNo=$(this).attr("data-orderNo");
			$(".ok").val(orderNo);
			$(".mask").show();
			$(".alert .promt").remove();
		})

		$(".ok").click(function(){
			orderNo=$(".ok").val();
			var cancelReason ="";
			if($(".cancel_r li.active").length<1){
				$(".alert .promt").remove();
				$(".alert textarea").after("<p class='promt'>原因不能为空</p>");
			return;
			}else if($(".cancel_r li.active").hasClass("other") && $(".alert textarea").val().trim()==""){
				$(".alert .promt").remove();
				$(".alert textarea").after("<p class='promt'>原因不能为空</p>");
				return;
			}else if($(".cancel_r li.active").hasClass("other") && $(".alert textarea").val().trim().length>200){
				$(".alert .promt").remove();
				$(".alert textarea").after("<p class='promt'>原因不能超过200字</p>");
				return;
			}else{
				$(".alert .promt").remove();
			}
			if($(".cancel_r li.active").hasClass("other")){
				cancelReason = $(".alert textarea").val();
			}else{
				cancelReason = $(".cancel_r li.active").text();
			}
			$.ajax({
			url: publicPath + "/api/reserveorders/cancelreserveorders",
			type: "post",
			data: {
				orderNo: orderNo,
       			cancelReason: cancelReason
			},
			dataType: "json",
			success: function success(data) {
				if(data.success) {
					if(data.code == 0) {
						window.location.reload();
						console.log(data.msg);
					} else {
						console.log(data.msg);
					}
				} else {
					console.log(data.msg);
				}
			}
		});
	})
	$(".cancel,.close").click(function(){
		$(".mask").hide();
	});
	$(".cancel_r li").click(function(){
		$(this).addClass("active").siblings().removeClass("active");
		if($(this).hasClass("other")){
			$(".alert textarea").css("display","block");
		}else{
			$(".alert textarea").hide();
		}
	})
})

</script>
</html>
