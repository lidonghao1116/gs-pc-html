<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link href="css/head-foot.css" rel="stylesheet" type="text/css" />
		<link href="css/myReservation.css" rel="stylesheet" type="text/css" />
		<link href="css/myProfile.css" rel="stylesheet" type="text/css" />
		<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/top.js"></script>
		<script type="text/javascript" src="js/myProfile.js"></script>
		<title>我的资料</title>
	</head>

	<body>
		<!--头部-->
		<div class="head_box">
			<div class="head">
				<div class="left logo">
					<a href="index.html" target="_self">
						<img src="img/logo0.png"/>
					</a>
				</div>
				<div class="left more_s">
					<select>
						<option>更多导航</option>
						<option>更多导航0</option>
						<option>更多导航1哈</option>
					</select>
				</div>
				<div class="right head_r">
					<ul> 
						<li><a href="login.html" target="_self">登录</a></li>
						<li><a href="myOrder.html" target="_self">我的订单</a></li>
						<li><a href="myProfile.html" target="_self">我的账户</a></li>
						<li class="wechat"><a href="#">官网微信</a>
							<div class="wechat_b">
							</div>
						</li>
					</ul>
					<div class="my_res">
						<span><a href="myReservation.html" target="_self">我的预约>></a></span>
					</div>
				</div>
			</div>
		</div>
		<!--主要内容-->
		<div class="content_b">
			<div class="content_nav">
				<p>个人中心</p>
				<ul>
					<li>
						<a href="myReservation.html" target="_self">我的预约</a>
					</li>
					<li>
						<a href="myOrder.html" target="_self">我的订单</a>
					</li>
					<li>
						<a class="activesp" href="myProfile.html" target="_self">我的资料</a>
					</li>
				</ul>
			</div>
		</div>
		<div class="main_content ">
			
			<div class="pro_file_meg">
				<h2 class="title_h2 title">账户信息</h2>
				<span class="pro_file">
				
			</span>
			</div>
			<div class="person_file">
				<h2 class="title_h2 title">基本信息  <span class="write">编辑</span></h2>
				<table border="0" cellspacing="0" cellpadding="0">
					<tr>
						<td class="person_file_name">姓名：</td>
						<td class="person_file_cont person_file_contt">
							<p class="no_edit" id="name"></p>
							<div class="edit">
								<input name="name" class="in_val" type="text" id="name" value=""/>
							</div>
						</td>
						<td class="person_file_name">性别：</td>
						<td class="person_file_cont person_file_sex">
							<p class="no_edit" id="sex"></p>
							<div class="edit">
								<select id="sel_sex">
									<option>请选择</option>
									<option value="01">男</option>
									<option value="02">女</option>
								</select>
							</div>
						</td>
					</tr>
					<tr>
						<td class="person_file_name">QQ：</td>
						<td class="person_file_cont person_file_qq">
							<p class="no_edit" id="qq"></p>
							<div class="edit">
								<input name="qq" class="in_val" type="text" class="" value=""/>
							</div>
						</td>
						<td class="person_file_name">微信号：</td>
						<td class="person_file_cont person_file_weixin">
							<p class="no_edit" id="weixin"></p>
							<div class="edit">
								<input name="wechat" class="in_val" type="text"  value=""/>
							</div>
						</td>
					</tr>
					<tr>
						<td class="person_file_name">地址：</td>
						<td class="person_file_cont  person_file_adrs" colspan="3">
							<p class="no_edit" id="adrs"></p>
							<div class="edit">
								<select class='pro_sel' id='pro_sel'>
									<option value=''>请选择省</option>
								</select>
								<select class='pro_sel' id='city_sel'>
									<option value=''>请选择市</option>
								</select>
								<select class='pro_sel' id='cou_sel'>
									<option value=''>请选择区</option>
								</select>
								<br/><input type="text" name="address" class="address" value=""/>
							</div>
						</td>
				    </tr>
			    </table>
			</div>    
		
		<div class="pro_btn">
			<input class="pro_btn_res" type="button" value="取消"/>
			<input class="pro_btn_sub" type="button" value="保存"/>
		</div>

    </div>
	<!--底部-->
	<div class="foot_box ">
		<div class="foot ">Copyright@2016上海家策教育科技有限公司<span>沪IPC备12345678号</span></div>
	</div>
	<div class="bottom_fixed ">
		<img class="top_img " src="img/qqren.png "/>
		<div class="link_phone ">
			<p>服务热线</p>
			<p>021-6666&nbsp;&nbsp;8888</p>
		</div>
		<div class="qq_link ">
			<p>QQ交谈</p>
			<p>QQ交谈</p>
			<p>QQ交谈</p>
		</div>
		<div class="lin_wechat ">
		</div>
		<div id="goTopBtn " class="back_top ">返回顶部</div>
	</div>

</body>
<script>
	$(document).ready(function(){
		var countryList = function(cityCode){
			 $("#cou_sel").html("<option>请选择区</option>");
			$.ajax({
				url:publicPath+"/api/common/getAreaData/c003",
				type:"post",
				data:{pcode:cityCode},
				dataType:"json",
				success:function(data){
					if(data.success){
		                if(data.code == 0){
		                	var dataJD = data.jsonData;
		                	var html="";
							$.each(dataJD, function(i,item) {
								html += "<option value='" + item.areaCode + "'>" + item.areaName + "</option>";
							});
							$("#cou_sel").append(html);
		                	console.log(data.msg);
		                }else{
		                    console.log(data.msg);
		                }
		            }else{
		                console.log(data.msg);
		            }
				},
			});
		}
		var cityList = function(proCode){
			$("#city_sel").html("<option>请选择市</option>");
		   	   $("#cou_sel").html("<option>请选择区</option>");
			$.ajax({
				url:publicPath+"/api/common/getAreaData/c002",
				type:"post",
				data:{pcode:proCode},
				dataType:"json",
				success:function(data){
					if(data.success){
		                if(data.code == 0){
		                	var dataJD = data.jsonData;
		                	var html="";
							$.each(dataJD, function(i,item) {
								html += "<option value='" + item.areaCode + "'>" + item.areaName + "</option>";
							});
							$("#city_sel").append(html);
		                	console.log(data.msg);
		                }else{
		                    console.log(data.msg);
		                }
		            }else{
		                console.log(data.msg);
		            }
				},
			});
		}
		$.ajax({
			type:"POST",
			url:publicPath+"/api/member/getMemberInfo",
			success:function(data){
				if(data.success){
	                if(data.code == 0){
	                	var dataJD = data.jsonData;
	                	$(".pro_file").html("手机号码&nbsp;&nbsp;"+dataJD[0].mobile);
	                	$("#name").html(dataJD[0].name);
	                	var sex = dataJD[0].sex.split(","); 
	                	$("#sel_sex").val(sex[0]);
	                	$("#sex").html(sex[1]);
	                	$("#qq").html(dataJD[0].qq);
	                	$("#weixin").html(dataJD[0].weixin);
	                	var provice = dataJD[0].provice.split(",");
	                	$("#pro_sel").html("<option value='" +provice[0]+ "'>"+provice[1]+"</option>");
	                	$.ajax({
	            			type:"POST",
	            			url:publicPath+"/api/common/getAreaData/c001",
	            			success:function(data){
	            				if(data.success){
	            	                if(data.code == 0){
	            	                	var dataJD = data.jsonData;
	            	                	var html = "";
	            						$.each(dataJD, function(i,item) {
	            							html = "<option value='" + item.areaCode + "'>" + item.areaName + "</option>";
	            							$("#pro_sel").append(html);
	            						});
	            	                	console.log(data.msg);
	            	                }else{
	            	                    console.log(data.msg);
	            	                }
	            	            }else{
	            	                console.log(data.msg);
	            	            }
	            			},
	            			error:function(){
	            				
	            			}
	            		});
	                	var city = dataJD[0].city.split(",");
	         			$("#city_sel").html("<option value='" +city[0]+ "'>"+city[1]+"</option>");
	         			$.ajax({
	        				url:publicPath+"/api/common/getAreaData/c002",
	        				type:"post",
	        				data:{pcode:provice[0]},
	        				dataType:"json",
	        				success:function(data){
	        					if(data.success){
	        		                if(data.code == 0){
	        		                	var dataJD = data.jsonData;
	        		                	var html="";
	        							$.each(dataJD, function(i,item) {
	        								html += "<option value='" + item.areaCode + "'>" + item.areaName + "</option>";
	        							});
	        							$("#city_sel").append(html);
	        		                	console.log(data.msg);
	        		                }else{
	        		                    console.log(data.msg);
	        		                }
	        		            }else{
	        		                console.log(data.msg);
	        		            }
	        				},
	        			});
	                	var county = dataJD[0].county.split(",");
	                	$("#cou_sel").html("<option value='" +county[0]+ "'>"+county[1]+"</option>");
	                	$.ajax({
	        				url:publicPath+"/api/common/getAreaData/c003",
	        				type:"post",
	        				data:{pcode:city[0]},
	        				dataType:"json",
	        				success:function(data){
	        					if(data.success){
	        		                if(data.code == 0){
	        		                	var dataJD = data.jsonData;
	        		                	var html="";
	        							$.each(dataJD, function(i,item) {
	        								html += "<option value='" + item.areaCode + "'>" + item.areaName + "</option>";
	        							});
	        							$("#cou_sel").append(html);
	        		                	console.log(data.msg);
	        		                }else{
	        		                    console.log(data.msg);
	        		                }
	        		            }else{
	        		                console.log(data.msg);
	        		            }
	        				},
	        			});
	         			
	         			
	         			var address = $("input[name='address']").val(dataJD[0].address);
	                	$("#adrs").html(provice[1]+city[1]+county[1]+dataJD[0].address);
	                	console.log(data.msg);
	                }else{
	                	
	                    console.log(data.msg);
	                }
	            }else{
	            	window.location.href="login.html";
	                console.log(data.msg);
	            }
			},
			error:function(){
				
			}
		});
		$.ajax({
			type:"POST",
			url:publicPath+"/api/common/getAreaData/c001",
			success:function(data){
				if(data.success){
	                if(data.code == 0){
	                	var dataJD = data.jsonData;
	                	var html = "";
						$.each(dataJD, function(i,item) {
							html = "<option value='" + item.areaCode + "'>" + item.areaName + "</option>";
							$("#pro_sel").append(html);
						});
	                	console.log(data.msg);
	                }else{
	                    console.log(data.msg);
	                }
	            }else{
	                console.log(data.msg);
	            }
			},
			error:function(){
				
			}
		});
		$("#pro_sel").change(function(){
			var proCode = $("#pro_sel").val();
			cityList(proCode);
		});
		$("#city_sel").change(function(){
			var cityCode = $("#city_sel").val();
			countryList(cityCode);
		});
		$(".pro_btn_sub").click(function(){
			var name = $("input[name='name']").val();
			var sex = $("#sel_sex").val();
			var qq = $("input[name='qq']").val();
			var wechat = $("input[name='wechat']").val();
			var provice = $("#pro_sel").val();
			var city = $("#city_sel").val();
			var county = $("#cou_sel").val();
			var address = $("input[name='address']").val();
			$.ajax({
				url:publicPath+"/api/member/updateMemberInfo",
				type:"post",
				data:{name:name,sex:sex,qq:qq,weixin:wechat,provice:provice,city:city,county:county,address:address},
				dataType:"json",
				success:function(data){
					if(data.success){
		                if(data.code == 0){
		                	location.reload();
		                	console.log(data.msg);
		                }else{
		                    console.log(data.msg);
		                }
		            }else{
		                console.log(data.msg);
		            }
				},
			});
		});
});
</script>
</html>